# إصلاح منطق حساب رصيد الإجازات

## المشكلة
كان منطق حساب رصيد الإجازات يعمل بشكل مختلف عن المطلوب. كان يقوم بحساب الإجازات بطريقة معقدة وغير واضحة.

## المنطق الجديد

### عند إضافة قصاصة حافز:

#### الإجازات الاعتيادية:
- **إذا كان حقل الإجازة الاعتيادية فارغ أو 0:**
  - يتم إضافة مكافأة الإجازات الاعتيادية من الإعدادات إلى الرصيد
  - مثال: إذا كان الرصيد 5 ومكافأة الإجازات 3، يصبح الرصيد 8

- **إذا كان حقل الإجازة الاعتيادية يحتوي على رقم:**
  - يتم إضافة مكافأة الإجازات الاعتيادية من الإعدادات
  - ثم طرح الرقم المدخل من حقل الإجازة
  - مثال: إذا كان الرصيد 5، مكافأة الإجازات 3، والرقم المدخل 4
  - الحساب: 5 + 3 - 4 = 4

#### الإجازات المرضية:
- **إذا كان حقل الإجازة المرضية فارغ أو 0:**
  - يتم إضافة مكافأة الإجازات المرضية من الإعدادات إلى الرصيد

- **إذا كان حقل الإجازة المرضية يحتوي على رقم:**
  - يتم إضافة مكافأة الإجازات المرضية من الإعدادات
  - ثم طرح الرقم المدخل من حقل الإجازة المرضية

### عند تعديل قصاصة حافز:

1. **إزالة تأثير القصاصة القديمة:**
   - إذا كانت القصاصة القديمة فارغة: طرح مكافأة الإجازات
   - إذا كانت القصاصة القديمة تحتوي على رقم: إضافة الرقم وطرح مكافأة الإجازات

2. **إضافة تأثير القصاصة الجديدة:**
   - إذا كانت القصاصة الجديدة فارغة: إضافة مكافأة الإجازات
   - إذا كانت القصاصة الجديدة تحتوي على رقم: إضافة مكافأة الإجازات وطرح الرقم

### عند حذف قصاصة حافز:

**إزالة تأثير القصاصة المحذوفة:**
- إذا كانت القصاصة فارغة: طرح مكافأة الإجازات من الرصيد
- إذا كانت القصاصة تحتوي على رقم: إضافة الرقم وطرح مكافأة الإجازات من الرصيد

## مثال عملي

### السيناريو:
- رصيد الإجازات الحالي: 5
- مكافأة الإجازات الاعتيادية: 3
- إضافة قصاصة حافز بحقل إجازة اعتيادية: 4

### الحساب:
1. إضافة مكافأة الإجازات: 5 + 3 = 8
2. طرح الرقم المدخل: 8 - 4 = 4
3. الرصيد النهائي: 4

## الدوال المحدثة

### 1. `addIncentiveSlip`
- تم تحديث منطق حساب رصيد الإجازات
- إضافة منطق جديد للتعامل مع الحقول الفارغة والأرقام

### 2. `updateIncentiveSlip`
- تم تحديث منطق حساب رصيد الإجازات
- إزالة تأثير القصاصة القديمة
- إضافة تأثير القصاصة الجديدة

### 3. `deleteIncentiveSlip`
- تم تحديث منطق حساب رصيد الإجازات
- إزالة تأثير القصاصة المحذوفة

## الفوائد
- منطق واضح ومفهوم لحساب رصيد الإجازات
- تطبيق صحيح للمكافآت من الإعدادات
- معالجة صحيحة للحقول الفارغة والأرقام
- سهولة في الفهم والصيانة

## الاختبار
يجب اختبار السيناريوهات التالية:
1. إضافة قصاصة حافز بحقل إجازة فارغ
2. إضافة قصاصة حافز بحقل إجازة يحتوي على رقم
3. تعديل قصاصة حافز من فارغ إلى رقم
4. تعديل قصاصة حافز من رقم إلى فارغ
5. حذف قصاصة حافز
6. التأكد من عدم وجود أرصدة سالبة 